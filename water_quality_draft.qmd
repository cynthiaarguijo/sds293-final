---
title: "water quality data :("
format: pdf
editor: visual
---
```{r}
library(tidyverse)
library(dplyr)
library(readr)
library(ggplot2)
Water_Quality_Sampling_Data <- read_csv("Water_Quality_Sampling_Data.csv")
```


```{r}
water_data <- Water_Quality_Sampling_Data |> mutate(SAMPLE_DATE = as.Date(SAMPLE_DATE, format = "%m/%d/%Y %I:%M:%S %p")) %>% mutate(YEAR = format(as.Date(SAMPLE_DATE), "%Y")) %>% mutate(MONTH = format(as.Date(SAMPLE_DATE), "%m")) %>% filter(YEAR > "2007", YEAR < "2020")
```


```{r}
# filter for all years but surface water and bacteria
bacteria_water <- water_data  %>% filter(PARAM_TYPE == "Bacteria/Pathogens")
bacteria_water<- bacteria_water %>% mutate(SAMPLE_DATE = as.Date(SAMPLE_DATE, format = "%m/%d/%Y %I:%M:%S %p"))
# year column
bacteria_water <- bacteria_water %>%
  mutate(YEAR = format(as.Date(SAMPLE_DATE), "%Y"))
# filter for 2010 and future
# year column
bacteria_water <- bacteria_water %>%
  filter(YEAR >"2007")

```

```{r}
ground_surface_water <- water_data |> filter(MEDIUM %in% c("Ground Water", "Surface Water", UNIT != "Pounds (lbs)"), PARAM_TYPE %in% c("Metals", "Bacteria/Pathogens"), YEAR == "2014")

ground_surface_water$RESULT[ground_surface_water$UNIT == "MG/L"] <- ground_surface_water$RESULT[ground_surface_water$UNIT == "MG/L"] * 1000
ground_surface_water$UNIT[ground_surface_water$UNIT == "MG/L"] <- "UG/L"
ground_surface_water$UNIT[ground_surface_water$UNIT == "MPN/100ML"] <- "Colonies/100mL"
```

```{r}
metals_soil <- water_data |> filter(MEDIUM == "Soil")
```




```{r}
# visualization for surface water bacteria ALL YEARS

# count number of observations per watershed per year
yearly_counts <- bacteria_water %>%
  group_by(WATERSHED, YEAR) %>%
  summarise(obs_count = n(), .groups = "drop")

# get  top 5 most sampled watersheds overall
top_5_watersheds <- yearly_counts %>%
  group_by(WATERSHED) %>%
  summarise(total_obs = sum(obs_count)) %>%
  arrange(desc(total_obs)) %>%
  slice(1:5) %>%
  pull(WATERSHED)

# filter to only the top 5 watersheds
top_watershed_data <- yearly_counts %>%
  filter(WATERSHED %in% top_5_watersheds)

# plot
ggplot(top_watershed_data, aes(x = as.numeric(YEAR), y = obs_count, color = WATERSHED)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "Top 5 Watersheds by Sampling Frequency (by Year)",
    x = "Year",
    y = "Number of Bacteria/Pathogens Observations",
    color = "Watershed"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(1990, 2025, 2)) +
  theme(legend.position = "bottom")
```


```{r}
# playing
# trying to see amount of metals? in water?? for ALL YEARS

metals_water <- Water_Quality_Sampling_Data %>% filter(PARAM_TYPE == "Metals") %>% filter(MEDIUM == "Surface Water") 
metals_water<- metals_water %>% mutate(SAMPLE_DATE = as.Date(SAMPLE_DATE, format = "%m/%d/%Y %I:%M:%S %p"))
```

```{r}
# visualization for surface water metals total for ALL YEARS

# convert mg/l to ug/l
metals_water$RESULTS[metals_water$UNIT == "MG/L"] <- metals_water$RESULTS[metals_water$UNIT == "MG/L"] * 1000
metals_water$UNIT[metals_water$UNIT == "MG/L"] <- "UG/L"


# count number of observations per watershed per year
yearly_counts <- metals_water %>%
 # filter(PARAMETER == "ZINC") %>%
  filter(UNIT == "UG/L") |>
  group_by(WATERSHED, YEAR) %>%
  summarise(obs_count = sum(RESULT), .groups = "drop")

# get  top 5 most sampled watersheds overall
top_5_watersheds <- yearly_counts %>%
  group_by(WATERSHED) %>%
  summarise(total_obs = sum(obs_count)) %>%
  arrange(desc(total_obs)) %>%
  slice(6:10) %>%
  pull(WATERSHED)

# filter to only the top 5 watersheds
top_watershed_data <- yearly_counts %>%
  filter(WATERSHED %in% top_5_watersheds)

# plot
ggplot(top_watershed_data, aes(x = as.numeric(YEAR), y = obs_count, color = WATERSHED)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "Top 5 Watersheds by Sampling Frequency (by Year)",
    x = "Year",
    y = "Number of Metals Observations",
    color = "Watershed"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(1990, 2025, 2)) +
  theme(legend.position = "bottom")
```


```{r}
# pcbs in surface water
pcbs_water <- Water_Quality_Sampling_Data %>%  filter(PARAM_TYPE == "PCBs")
pcbs_water<- pcbs_water %>% mutate(SAMPLE_DATE = as.Date(SAMPLE_DATE, format = "%m/%d/%Y %I:%M:%S %p"))
```

```{r}
# visualization for all water pcbs ALL YEARS

# year column
pcbs_water <- pcbs_water %>%
  mutate(YEAR = format(as.Date(SAMPLE_DATE), "%Y"))

# count number of observations per watershed per year
yearly_counts <- pcbs_water %>%
  group_by(WATERSHED, YEAR) %>%
  summarise(obs_count = n(), .groups = "drop")

# get  top 5 most sampled watersheds overall
top_5_watersheds <- yearly_counts %>%
  group_by(WATERSHED) %>%
  summarise(total_obs = sum(obs_count)) %>%
  arrange(desc(total_obs)) %>%
  slice(1:10) %>%
  pull(WATERSHED)

# filter to only the top 5 watersheds
top_watershed_data <- yearly_counts %>%
  filter(WATERSHED %in% top_5_watersheds)

# plot
ggplot(top_watershed_data, aes(x = as.numeric(YEAR), y = obs_count, color = WATERSHED)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "Top 5 Watersheds by Sampling Frequency (by Year)",
    x = "Year",
    y = "Number of Bacteria/Pathogens Observations",
    color = "Watershed"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(1990, 2025, 2)) +
  theme(legend.position = "bottom")
```

```{r}
# visualization for surface water bacteria total results per year

# year column
bacteria_water <- bacteria_water |>
  mutate(YEAR = format(as.Date(SAMPLE_DATE), "%Y"))

# count number of observations per watershed per year
yearly_counts <- bacteria_water %>%
  filter(UNIT == "Colonies/100mL") %>%
  filter(PARAMETER == "E COLI BACTERIA") |>
  group_by(WATERSHED, YEAR) %>% 
  summarise(sum_result = sum(RESULT), .groups = "drop")

# get  top 5 most sampled watersheds overall
top_5_watersheds <- yearly_counts |>
  group_by(WATERSHED) |>
  summarise(total_obs = sum(sum_result)) |>
  arrange(desc(total_obs)) |>
  slice(1:5) |>
  pull(WATERSHED)

# filter to only the top 5 watersheds
top_watershed_data <- yearly_counts %>%
  filter(WATERSHED %in% top_5_watersheds)

# plot
ggplot(top_watershed_data, aes(x = as.numeric(YEAR), y = sum_result, color = WATERSHED)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "Top 5 Watersheds by Sampling Frequency (by Year)",
    x = "Year",
    y = "Number of Bacteria/Pathogens Observations",
    color = "Watershed"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(1990, 2025, 2)) +
  theme(legend.position = "bottom")
```




# this one:

```{r}
reverse_geo <- bacteria_water %>% head() |>
    reverse_geocode(lat = LAT_DD_WGS84, long = LON_DD_WGS84, address = addr, method = "osm")
```
```{r}
# census_tracts <- reverse_geo %>%
#     geocode(address = addr,  method = "census", full_results = TRUE, api_options = list(census_return_type = 'geographies'))
```

